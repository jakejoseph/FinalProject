<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>144 Years of the Shapes and Sizes of Baseball Players </title>
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
    <style type="text/css">
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
        
        .legend_circ {
            fill: black;
            opacity: .33;
        }
        
        .legend_line {
            stroke: black;
            opacity: .75
        }
        
        .legend_label {
            font-size: 11px;
            font-family: sans-serif;
            text-anchor: start;
        }
        
        .legend_title {
            font-size: 15px;
            font-family: sans-serif;
            text-anchor: start;
        }
        
        .axis text {
            font-family: sans-serif;
            font-size: 11px;
        }
        
        h2 {
            color: black;
            text-align: center;
        }
        
        div.years_buttons {
            position: fixed;
            top: 5px;
            left: 50px;
            font-family: sans-serif;
        }
        
        div.years_buttons span {
            background-color: lightgrey;
            outline-color: black;
            padding: 5px;
            margin: 10px;
            border-radius: 3px;
            cursor:pointer;
        }
        
        div.tooltip {
            position: fixed;
            text-align: center;
            width: 100px;
            height: 50px;
            padding: 2px;
            font: 11px sans-serif;
            background: darkgrey;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
            color: black;
            z-index: 1000;
        }
        div.tooltip2 {
            position: fixed;
            text-align: center;
            width: 50px;
            height: 25px;
            padding: 2px;
            font: 11px sans-serif;
            background: white;
            border: 1px;
            border-style: solid;
            border-radius: 8px;
            pointer-events: none;
            color: black;
            z-index: 1000;
            border-color: black;
        }
        
        .page_title{
                font-size:30px;
                font-family:sans-serif;
                fill:darkgrey;
        }
        .label{
                font-size:14px;
                font-family:sans-serif;
        }
    </style>
<script type="text/javascript">
    function draw_BMI(dataset) {
        //set years to be displayed for quick access
        var year_int_name = [1871, 1921, 1951, 1980, 1990, 2000, 2010, 2015];
        //sort data by year
        var byYearData = d3.nest()
            .key(function (d) {
                return d['debut'].getUTCFullYear()
            })
            .sortKeys(d3.ascending)
            .entries(dataset);
        //set borders and padding for svg object
        var w = 1400;
        var h = 800;
        var wPadding = 50;
        var hPadding = 50;
        var axisHPadding = 50;
        var axisWPadding = 51;
        //define scales based on max and min of each element - note BMI and height are linear
        //radius is swuareroot scale to correct for squared radius impact on size of bubble
        var yScale = d3.scale.linear()
            .domain([d3.min(dataset, function (d) {
                return d["BMI"];
            }), d3.max(dataset, function (d) {
                return d["BMI"];
            })])
            .range([h - hPadding, hPadding]);

        var xScale = d3.scale.linear()
            .domain([d3.min(dataset, function (d) {
                return d["height"];
            }), d3.max(dataset, function (d) {
                return d["height"];
            })])
            .range([wPadding, w - wPadding]);

        var rScale = d3.scale.sqrt()
            .domain([d3.min(dataset, function (d) {
                return d["weight"];
            }), d3.max(dataset, function (d) {
                return d["weight"];
            })])
            .range([5, 30]);
        // make svg object for all d3 object placement
        var svg = d3.select("body").append("svg");
        svg.attr("width", w)
            .attr("height", h);
        // append axes in separate group at head of document
        // move axes based on axisPadding to allow additional padding for data
        var xAxis = d3.svg.axis();
        xAxis.scale(xScale);
        xAxis.orient("bottom")
        xAxis.ticks(10);
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(-1," + (h - axisHPadding) + ")")
            .call(xAxis);

        var yAxis = d3.svg.axis();
        yAxis.scale(yScale);
        yAxis.orient("right");
        svg.append("g")
            .attr("class", "axis")
            .attr("transform", "translate(" + (w - axisWPadding) + ",0)")
            .call(yAxis);

        //append title to page
        svg.append("text")
            .attr("class", "page_title")
            .attr("text-anchor", "start")
            .attr("x", wPadding - 2)
            .attr("y", hPadding)
            .text("144 Years of the Shapes and Sizes of Baseball Players");
        //append labels to page
        svg.append("text")
            .attr("class", "x label")
            .attr("text-anchor", "end")
            .attr("x", w / 2)
            .attr("y", h - 4)

            .text("Height in inches");

        svg.append("text")
            .attr("class", "y label")
            .attr("text-anchor", "end")
            .attr("x", w - 15)
            .attr("y", h / 2)
            .attr("transform", "rotate(270," + (w - 15) + "," + h / 2 + ")")
            .text("BMI");
        // append circle legend to page
        // consists of three overlapping circles with 
        // lines designating the legend
        svg.append("circle")
            .attr("class", "legend_circ")
            .attr("cx", w * .25 + 210)
            .attr("cy", h / 2 + 145)
            .attr("r", rScale(175));


        svg.append("circle")
            .attr("class", "legend_circ")
            .attr("cx", w * .25 + 210)
            .attr("cy", (h / 2 + 145) + 5)
            .attr("r", rScale(225));

        svg.append("circle")
            .attr("class", "legend_circ")
            .attr("cx", w * .25 + 210)
            .attr("cy", (h / 2 + 145) + 9)
            .attr("r", rScale(275));
        // this code defines the lines - the additional
        // subtraction and addition at the end of each line is
        // done to keep the relative position the same as previous 
        // text elements
        svg.append("line")
            .attr("class", "legend_line")
            .attr("x1", w * .25 + 210)
            .attr("x2", w * .25 + 130)
            .attr("y1", (h / 2 + 145) - 18)
            .attr("y2", (h / 2 + 145) - 18);

        svg.append("line")
            .attr("class", "legend_line")
            .attr("x1", w * .25 + 210)
            .attr("x2", w * .25 + 100)
            .attr("y1", (h / 2 + 145) + 17)
            .attr("y2", (h / 2 + 145) + 17);
        svg.append("line")
            .attr("class", "legend_line")
            .attr("x1", w * .25 + 210)
            .attr("x2", w * .25 + 20)
            .attr("y1", (h / 2 + 145) + 26)
            .attr("y2", (h / 2 + 145) + 26);

        svg.append("line")
            .attr("class", "legend_line")
            .attr("x1", w * .25 + 210)
            .attr("x2", w * .25 - 50)
            .attr("y1", (h / 2 + 145) + 35)
            .attr("y2", (h / 2 + 145) + 35);
        //labels for legend
        svg.append("text")
            .attr("class", "legend_label")
            .attr("x", w * .25 + 105)
            .attr("y", (h / 2 + 145) + 15)
            .text("175 Pounds");

        svg.append("text")
            .attr("class", "legend_label")
            .attr("x", w * .25 + 25)
            .attr("y", (h / 2 + 145) + 24)
            .text("225 Pounds");

        svg.append("text")
            .attr("class", "legend_label")
            .attr("x", w * .25 - 45)
            .attr("y", (h / 2 + 145) + 33)
            .text("275 Pounds");

        svg.append("text")
            .attr("class", "legend_title")
            .attr("x", w * .25 - 50)
            .attr("y", (h / 2 + 145) - 13)
            .text("Player Weight")

        svg.append("text")
            .attr("class", "legend_title")
            .attr("x", w * .25 - 50)
            .attr("y", (h / 2 + 145))
            .style("fill", "red")
            .text("Red Indicates Average Player");
        // divs for tooltip on data
        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        // div for tooltip for navigation span
        var div2 = d3.select("body").append("div")
            .attr("class", "tooltip2")
            .style("opacity", 0);
        var para = d3.select("body").append("p")
            .attr("class","slider");


        // function for looping through the dataset
        // clears by year, but keeps persistent average as red
        // circle
        function draw_by_year(byYearData, i) {
            // set circles based on year data called from index i
            var circles = svg.selectAll("#wt-circ")
                .data(byYearData[i].values, function (d) {
                    return d['playerKey'];
                });
            // take out old data
            circles.exit().remove()
            // draw grey circles for all data
            circles.enter()
                .append("circle")
                .attr("id", "wt-circ")
                .attr("class", function (d) {
                    return "wt " + d['nameFirst'] + " " + d['nameLast'] + " " + d['debut'].getUTCFullYear();
                })
                .transition()
                .duration(350)
                .attr("r", function (d) {
                    return rScale(d['weight']);
                })
                .attr("cy", function (d) {
                    return yScale(d["BMI"]);
                })
                .attr("cx", function (d) {
                    return xScale(d["height"]);
                })
                .attr("opacity", ".2")
                .attr("color", "darkgrey")
                .transition()
                .duration(1000)
                .attr("opacity", "0");

            // display the year
            var year_text = svg.selectAll("#yr-text")
                .data(byYearData[i].values, function (d) {
                    return d['playerKey'];
                });

            year_text.exit().remove()
            year_text.enter()
                .append("text")
                .attr("id", "yr-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "50px")
                .attr("x", w * .25 - 50)
                .attr("y", h / 2)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Year: " + d['debut'].getUTCFullYear();
                })
            // display bmi - note the round function to reduce display size
            var bmi_text = svg.selectAll("#bmi-text")

                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
            bmi_text.exit().remove();
            bmi_text.enter().append("text");
            bmi_text.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "bmi-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "20px")
                .attr("x", w * .25 - 50)
                .attr("y", (h / 2) + 100)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Average BMI:" + ((Math.round(+d['BMI'] * 100)) / 100);
                })
            // display weight - note round function
            var wt_text = svg.selectAll("#wt-text")

                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
            wt_text.exit().remove();
            wt_text.enter().append("text");
            wt_text.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "wt-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "20px")
                .attr("x", w * .25 - 50)
                .attr("y", (h / 2) + 75)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Average Weight in pounds:" + Math.round(+d['weight']);
                })
            // Display height
            var ht_text = svg.selectAll("#ht-text")

                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
            ht_text.exit().remove();
            ht_text.enter().append("text");

            ht_text.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "ht-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "20px")
                .attr("x", w * .25 - 50)
                .attr("y", (h / 2) + 50)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Average Height in inches:" + ((Math.round(+d['height'] * 10)) / 10);
                })


                ;
            // display persistent averages
            var avgs = svg.selectAll("dot")
                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
                .enter().append("circle")
            // note - does not remove the previous circle - just updates
            avgs.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "avg-circ")
                .attr("class", function (d) {
                    return "avg " + d['nameFirst'] + " " + d['nameLast'] + " " + d['debut'].getUTCFullYear();
                })
                .attr("r", function (d) {
                    return rScale(d['weight']);
                })
                .attr("cy", function (d) {
                    return yScale(d["BMI"]);
                })
                .attr("cx", function (d) {
                    return xScale(d["height"]);
                })
                .attr("fill", "red")
                .attr("opacity", "0.6");

        }
        //function to run after animation runs.  This function clears all plotting.
        function draw_by_year_clear(byYearData, i) {




            var circles = svg.selectAll("#wt-circ")
                .data(byYearData[i].values, function (d) {
                    return d['playerKey'];
                })

            circles.exit().remove()


            circles.enter()
                .append("circle")
                .attr("id", "wt-circ")
                .attr("class", function (d) {
                    return "wt " + d['nameFirst'] + " " + d['nameLast'] + " " + d['debut'].getUTCFullYear();
                })

                .attr("r", function (d) {
                    return rScale(d['weight']);
                })
                .attr("cy", function (d) {
                    return yScale(d["BMI"]);
                })
                .attr("cx", function (d) {
                    return xScale(d["height"]);
                })

                .attr("opacity", ".1")
                .attr("color", "darkgrey")
                // Display tooltips for player data on weight and height
                .on("mouseover", function (d) {
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.html((d.nameFirst) + " " + d.nameLast + "<br>BMI: " + (Math.round(+d['BMI'] * 100)) /
                        100 + "<br> Height: " + d.height + " in." + "<br> Weight: " + d.weight + " lbs.")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                // when bubble is clicked, open google search for player with year and baseball keywords
                .on("click", function (d) {
                    window.open("https://www.google.com/search?q=baseball+" + d['debut'].getUTCFullYear() + "+" + d['nameLast'] + "+" + d['nameFirst']);
                })



                ;




            var year_text = svg.selectAll("#yr-text")
                .data(byYearData[i].values, function (d) {
                    return d['playerKey'];
                });

            year_text.exit().remove()
            year_text.enter()
                .append("text")
                .attr("id", "yr-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "50px")
                .attr("x", w * .25 - 50)
                .attr("y", h / 2)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Year: " + d['debut'].getUTCFullYear();
                })

            var bmi_text = svg.selectAll("#bmi-text")

                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
            bmi_text.exit().remove();
            bmi_text.enter().append("text");
            bmi_text.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "bmi-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "20px")
                .attr("x", w * .25 - 50)
                .attr("y", (h / 2) + 100)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Average BMI:" + ((Math.round(+d['BMI'] * 100)) / 100);
                })

            var wt_text = svg.selectAll("#wt-text")

                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
            wt_text.exit().remove();
            wt_text.enter().append("text");
            wt_text.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "wt-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "20px")
                .attr("x", w * .25 - 50)
                .attr("y", (h / 2) + 75)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Average Weight in pounds:" + Math.round(+d['weight']);
                })

            var ht_text = svg.selectAll("#ht-text")

                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
            ht_text.exit().remove();
            ht_text.enter().append("text");
            ht_text.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "ht-text")
                .attr("font-family", "sans-serif")
                .attr("font-size", "20px")
                .attr("x", w * .25 - 50)
                .attr("y", (h / 2) + 50)
                .attr("fill", "darkgrey")
                .attr("opacity", ".9")
                .text(function (d) {
                    return "Average Height in inches:" + ((Math.round(+d['height'] * 10)) / 10);
                })


                ;


            d3.selectAll("#avg-circ")
                .remove();
            d3.selectAll("#avg-circ2")
                .remove();





            var avgs2 = svg.selectAll("dot2")
                .data(byYearData[i].values, function (d) {
                    return d['nameLast'];
                })
            avgs2.exit().remove()
            avgs2.enter().append("circle")

            avgs2.filter(function (d) {
                return d['nameLast'] == "Average";
            })
                .attr("id", "avg-circ2")
                .attr("class", function (d) {
                    return "avg2 " + d['nameFirst'] + " " + d['nameLast'] + " " + d['debut'].getUTCFullYear();
                })
                .attr("r", function (d) {
                    return rScale(d['weight']);
                })
                .attr("cy", function (d) {
                    return yScale(d["BMI"]);
                })
                .attr("cx", function (d) {
                    return xScale(d["height"]);
                })
                .attr("fill", "red")
                .attr("opacity", "0.8");

        }
        var year_idx = 100;

        var year_interval = setInterval(function () {
            draw_by_year(byYearData, year_idx);

            year_idx = year_idx + 4;

            if (year_idx >= byYearData.length) {
                clearInterval(year_interval);

                var buttons = d3.select("body")
                    .append("div")
                    .attr("class", "years_buttons")
                    .selectAll("span")
                    .data(year_int_name)
                    .enter()
                    .append("span")
                    .text(function (d) {
                        return d;
                    });
                buttons.on("click", function (d) {

                    d3.select(".years_buttons")
                        .selectAll("span")
                        .transition()
                        .duration(500)
                        .style("color", "black")
                        .style("background", "darkgrey");

                    d3.select(this)
                        .transition()
                        .duration(500)
                        .style("background", "lightgrey")
                        .style("color", "black");
                    draw_by_year_clear(byYearData, d - 1871)
                })
                buttons.on("mouseover", function (d) {
                    d3.select(this);
                    div2.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div2.html("Data for " + d)
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY + 17) + "px");
                })
                buttons.on("mouseout", function (d) {
                    div2.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

                var slider = d3.select("body")
                                .append("p")
                                .attr("class","slider")
                                .attr("id","year_slider")
                                .html("<input type ='range'> ");

            }

        }, 750);


    }
</script>
</head>

<body>
    <script>
        format = d3.time.format("%Y");
        d3.csv("BMI_w_averages2.csv",
            function (d) {
                d["BMI"] = +d["BMI"];
                d["height"] = +d["height"];
                d["weight"] = +d["weight"];
                d["debut"] = format.parse(d[
                    "debut"]);
                d['playerKey'] = +d['playerKey'];
                return d;

            }, draw_BMI);
    </script>
</body>

</html>